# GMG Polar no FMG
gmgpolar_no_fmg = [
    1.02e-05, 5.11e-06, 1.49e-06, 9.24e-07, 6.71e-07, 4.96e-07, 3.61e-07,
    2.59e-07, 1.83e-07, 1.29e-07, 9.02e-08, 6.28e-08, 4.36e-08, 3.02e-08,
    2.09e-08, 1.45e-08, 9.99e-09, 6.90e-09, 4.76e-09, 3.28e-09, 2.26e-09,
    1.56e-09, 1.08e-09, 7.42e-10, 5.12e-10, 3.53e-10, 2.43e-10, 1.68e-10,
    1.16e-10, 7.98e-11, 5.50e-11, 3.79e-11, 2.62e-11, 1.80e-11, 1.24e-11,
    8.59e-12, 5.93e-12, 4.09e-12, 2.82e-12, 1.95e-12, 1.34e-12, 9.28e-13,
    6.41e-13, 4.42e-13, 3.06e-13, 2.11e-13, 1.46e-13, 1.01e-13, 6.96e-14,
    4.81e-14, 3.33e-14, 2.30e-14, 1.59e-14, 1.10e-14, 7.61e-15
]
time_gmgpolar_no_fmg = 32.2416

# GMG Polar 1xF FMG
gmgpolar_1xF_FMG = [
    2.72e-09, 1.49e-09, 9.43e-10, 6.23e-10, 4.20e-10, 2.85e-10, 1.95e-10,
    1.33e-10, 9.14e-11, 6.26e-11, 4.29e-11, 2.94e-11, 2.01e-11, 1.37e-11,
    9.40e-12, 6.43e-12, 4.39e-12, 3.00e-12, 2.05e-12, 1.40e-12, 9.57e-13,
    6.54e-13, 4.47e-13, 3.05e-13, 2.09e-13, 1.43e-13, 9.77e-14, 6.69e-14,
    4.59e-14, 3.14e-14, 2.16e-14, 1.48e-14, 1.02e-14, 7.01e-15
]
time_gmgpolar_1xF_FMG = 20.6226

# GMG Polar 2xF FMG
gmgpolar_2xF_FMG = [
    1.20e-09, 7.46e-10, 4.78e-10, 3.10e-10, 2.03e-10, 1.34e-10, 8.86e-11,
    5.88e-11, 3.90e-11, 2.59e-11, 1.73e-11, 1.15e-11, 7.65e-12, 5.09e-12,
    3.39e-12, 2.26e-12, 1.51e-12, 1.00e-12, 6.70e-13, 4.47e-13, 2.98e-13,
    1.99e-13, 1.32e-13, 8.83e-14, 5.89e-14, 3.93e-14, 2.62e-14, 1.75e-14,
    1.17e-14, 7.78e-15
]
time_gmgpolar_2xF_FMG = 19.0494

# GMG Polar 3xF FMG
gmgpolar_3xF_FMG = [
    7.45e-10, 4.77e-10, 3.10e-10, 2.03e-10, 1.34e-10, 8.85e-11, 5.87e-11,
    3.90e-11, 2.59e-11, 1.72e-11, 1.15e-11, 7.63e-12, 5.09e-12, 3.39e-12,
    2.26e-12, 1.50e-12, 1.00e-12, 6.68e-13, 4.46e-13, 2.97e-13, 1.98e-13,
    1.32e-13, 8.81e-14, 5.87e-14, 3.92e-14, 2.61e-14, 1.74e-14, 1.16e-14,
    7.75e-15
]
time_gmgpolar_3xF_FMG = 19.2881

# GMG Polar 4xF FMG
gmgpolar_4xF_FMG = [
    4.77e-10, 3.10e-10, 2.03e-10, 1.34e-10, 8.85e-11, 5.87e-11, 3.90e-11,
    2.59e-11, 1.72e-11, 1.15e-11, 7.63e-12, 5.08e-12, 3.39e-12, 2.26e-12,
    1.50e-12, 1.00e-12, 6.68e-13, 4.46e-13, 2.97e-13, 1.98e-13, 1.32e-13,
    8.81e-14, 5.87e-14, 3.92e-14, 2.61e-14, 1.74e-14, 1.16e-14, 7.75e-15
]
time_gmgpolar_4xF_FMG = 19.4280



# 1xV PCG no FMG
pcg_no_fmg = [
    1.02e-05, 6.79e-06, 5.70e-08, 1.08e-08, 2.16e-09, 4.03e-10,
    6.31e-11, 1.31e-11, 2.62e-12, 6.31e-13, 1.36e-13, 3.35e-14,
    9.18e-15
]
time_pcg_no_fmg = 10.6084

# 1xV PCG 1xF FMG
pcg_1xF_FMG = [
    2.72e-09, 7.53e-10, 1.74e-10, 2.84e-11, 7.22e-12, 1.81e-12,
    4.38e-13, 1.18e-13, 3.37e-14, 1.06e-14, 3.01e-15
]
time_pcg_1xF_FMG = 9.80234

# 1xV PCG 2xF FMG
pcg_2xF_FMG = [
    1.20e-09, 2.82e-10, 6.72e-11, 1.39e-11, 3.30e-12, 3.31e-13,
    2.58e-14, 1.69e-14, 4.50e-15
]
time_pcg_2xF_FMG = 8.95836

# 1xV PCG 3xF FMG
pcg_3xF_FMG = [
    7.45e-10, 1.58e-10, 3.82e-11, 6.77e-12, 1.67e-12, 2.07e-13,
    2.60e-14, 2.00e-15
]
time_pcg_3xF_FMG = 8.78017

# 1xV PCG 4xF FMG
pcg_4xF_FMG = [
    4.77e-10, 9.08e-11, 2.25e-11, 3.57e-12, 8.36e-13, 9.84e-14,
    1.08e-14, 1.37e-15
]
time_pcg_4xF_FMG = 9.54801



# GMG Polar no FMG
gmgpolar_no_fmg = [
    1.02e-05, 5.11e-06, 1.49e-06, 9.24e-07, 6.71e-07, 4.96e-07, 3.61e-07,
    2.59e-07, 1.83e-07, 1.29e-07, 9.02e-08, 6.28e-08, 4.36e-08, 3.02e-08,
    2.09e-08, 1.45e-08, 9.99e-09, 6.90e-09, 4.76e-09, 3.28e-09, 2.26e-09,
    1.56e-09, 1.08e-09, 7.42e-10, 5.12e-10, 3.53e-10, 2.43e-10, 1.68e-10,
    1.16e-10, 7.98e-11, 5.50e-11, 3.79e-11, 2.62e-11, 1.80e-11, 1.24e-11,
    8.59e-12, 5.93e-12, 4.09e-12, 2.82e-12, 1.95e-12, 1.34e-12, 9.28e-13,
    6.41e-13, 4.42e-13, 3.06e-13, 2.11e-13, 1.46e-13, 1.01e-13, 6.96e-14,
    4.81e-14, 3.33e-14, 2.30e-14, 1.59e-14, 1.10e-14, 7.61e-15
]
time_gmgpolar_no_fmg = 32.2416

# GMG Polar 1xF FMG
gmgpolar_1xF_FMG = [
    2.72e-09, 1.49e-09, 9.43e-10, 6.23e-10, 4.20e-10, 2.85e-10, 1.95e-10,
    1.33e-10, 9.14e-11, 6.26e-11, 4.29e-11, 2.94e-11, 2.01e-11, 1.37e-11,
    9.40e-12, 6.43e-12, 4.39e-12, 3.00e-12, 2.05e-12, 1.40e-12, 9.57e-13,
    6.54e-13, 4.47e-13, 3.05e-13, 2.09e-13, 1.43e-13, 9.77e-14, 6.69e-14,
    4.59e-14, 3.14e-14, 2.16e-14, 1.48e-14, 1.02e-14, 7.01e-15
]
time_gmgpolar_1xF_FMG = 20.6226

# GMG Polar 2xF FMG
gmgpolar_2xF_FMG = [
    1.20e-09, 7.46e-10, 4.78e-10, 3.10e-10, 2.03e-10, 1.34e-10, 8.86e-11,
    5.88e-11, 3.90e-11, 2.59e-11, 1.73e-11, 1.15e-11, 7.65e-12, 5.09e-12,
    3.39e-12, 2.26e-12, 1.51e-12, 1.00e-12, 6.70e-13, 4.47e-13, 2.98e-13,
    1.99e-13, 1.32e-13, 8.83e-14, 5.89e-14, 3.93e-14, 2.62e-14, 1.75e-14,
    1.17e-14, 7.78e-15
]
time_gmgpolar_2xF_FMG = 19.0494

# GMG Polar 3xF FMG
gmgpolar_3xF_FMG = [
    7.45e-10, 4.77e-10, 3.10e-10, 2.03e-10, 1.34e-10, 8.85e-11, 5.87e-11,
    3.90e-11, 2.59e-11, 1.72e-11, 1.15e-11, 7.63e-12, 5.09e-12, 3.39e-12,
    2.26e-12, 1.50e-12, 1.00e-12, 6.68e-13, 4.46e-13, 2.97e-13, 1.98e-13,
    1.32e-13, 8.81e-14, 5.87e-14, 3.92e-14, 2.61e-14, 1.74e-14, 1.16e-14,
    7.75e-15
]
time_gmgpolar_3xF_FMG = 19.2881

# GMG Polar 4xF FMG
gmgpolar_4xF_FMG = [
    4.77e-10, 3.10e-10, 2.03e-10, 1.34e-10, 8.85e-11, 5.87e-11, 3.90e-11,
    2.59e-11, 1.72e-11, 1.15e-11, 7.63e-12, 5.08e-12, 3.39e-12, 2.26e-12,
    1.50e-12, 1.00e-12, 6.68e-13, 4.46e-13, 2.97e-13, 1.98e-13, 1.32e-13,
    8.81e-14, 5.87e-14, 3.92e-14, 2.61e-14, 1.74e-14, 1.16e-14, 7.75e-15
]
time_gmgpolar_4xF_FMG = 19.4280



# 1xV PCG no FMG
pcg_no_fmg = [
    1.02e-05, 6.79e-06, 5.70e-08, 1.08e-08, 2.16e-09, 4.03e-10,
    6.31e-11, 1.31e-11, 2.62e-12, 6.31e-13, 1.36e-13, 3.35e-14,
    9.18e-15
]
time_pcg_no_fmg = 10.6084

# 1xV PCG 1xF FMG
pcg_1xF_FMG = [
    2.72e-09, 7.53e-10, 1.74e-10, 2.84e-11, 7.22e-12, 1.81e-12,
    4.38e-13, 1.18e-13, 3.37e-14, 1.06e-14, 3.01e-15
]
time_pcg_1xF_FMG = 9.80234

# 1xV PCG 2xF FMG
pcg_2xF_FMG = [
    1.20e-09, 2.82e-10, 6.72e-11, 1.39e-11, 3.30e-12, 3.31e-13,
    2.58e-14, 1.69e-14, 4.50e-15
]
time_pcg_2xF_FMG = 8.95836

# 1xV PCG 3xF FMG
pcg_3xF_FMG = [
    7.45e-10, 1.58e-10, 3.82e-11, 6.77e-12, 1.67e-12, 2.07e-13,
    2.60e-14, 2.00e-15
]
time_pcg_3xF_FMG = 8.78017

# 1xV PCG 4xF FMG
pcg_4xF_FMG = [
    4.77e-10, 9.08e-11, 2.25e-11, 3.57e-12, 8.36e-13, 9.84e-14,
    1.08e-14, 1.37e-15
]
time_pcg_4xF_FMG = 9.54801


import matplotlib.pyplot as plt

# Define iteration counts automatically from array lengths
iters = {
    "gmgpolar_no_fmg": list(range(len(gmgpolar_no_fmg))),
    "gmgpolar_1xF_FMG": list(range(len(gmgpolar_1xF_FMG))),
    "gmgpolar_2xF_FMG": list(range(len(gmgpolar_2xF_FMG))),
    "gmgpolar_3xF_FMG": list(range(len(gmgpolar_3xF_FMG))),
    "pcg_no_fmg": list(range(len(pcg_no_fmg))),
    "pcg_1xF_FMG": list(range(len(pcg_1xF_FMG))),
    "pcg_2xF_FMG": list(range(len(pcg_2xF_FMG))),
    "pcg_3xF_FMG": list(range(len(pcg_3xF_FMG))),
}

# Map data and times
data = {
    "GMGPolar No FMG": (gmgpolar_no_fmg, time_gmgpolar_no_fmg, "tab:blue", "-o"),
    "GMGPolar 1xF FMG": (gmgpolar_1xF_FMG, time_gmgpolar_1xF_FMG, "tab:green", "-s"),
    "GMGPolar 2xF FMG": (gmgpolar_2xF_FMG, time_gmgpolar_2xF_FMG, "tab:orange", "-^"),
    "GMGPolar 3xF FMG": (gmgpolar_3xF_FMG, time_gmgpolar_3xF_FMG, "tab:red", "-d"),
    "PCG No FMG": (pcg_no_fmg, time_pcg_no_fmg, "tab:blue", "--o"),
    "PCG 1xF FMG": (pcg_1xF_FMG, time_pcg_1xF_FMG, "tab:green", "--s"),
    "PCG 2xF FMG": (pcg_2xF_FMG, time_pcg_2xF_FMG, "tab:orange", "--^"),
    "PCG 3xF FMG": (pcg_3xF_FMG, time_pcg_3xF_FMG, "tab:red", "--d"),
}

plt.figure(figsize=(10,7))

# Plot all curves
for label, (residuals, t, color, style) in data.items():
    it = range(len(residuals))
    plt.semilogy(it, residuals, style, color=color, label=f"{label}")
    
    # Place time annotation slightly lower than the last residual
    plt.text(
        it[-1]+0.2, residuals[-1]*0.5,   # shift down in log scale
        f"{t:.2f}s", 
        fontsize=8, color=color
    )

# Formatting
plt.xlabel("Iteration")
plt.ylabel(r"$\|r_k\|$")
plt.title("Residual Convergence: GMGPolar vs MG-PCG\nConfig: Czarny, CartesianR6, Implicit Extrapolation (1537 Ã— 2048)")
plt.legend(fontsize=9)
plt.grid(True, which="both", ls="--", alpha=0.6)

plt.tight_layout()
plt.savefig("residual_convergence_times.png", dpi=300)
plt.show()
